FROM node:15.8.0-alpine AS build
WORKDIR /app

COPY package.json .
COPY package-lock.json .

RUN npm install

COPY . .

ARG REACT_APP_API_ADDRESS
ARG REACT_APP_KATNIP_ADDRESS
ARG REACT_APP_STARCOIN_LIVE_ADDRESS
RUN REACT_APP_API_ADDRESS=${REACT_APP_API_ADDRESS} REACT_APP_KATNIP_ADDRESS=${REACT_APP_KATNIP_ADDRESS} REACT_APP_STARCOIN_LIVE_ADDRESS=${REACT_APP_STARCOIN_LIVE_ADDRESS} npm run build

FROM node:15.8.0-alpine
WORKDIR /app

RUN npm install -g serve

COPY --from=build /app/build /app/
